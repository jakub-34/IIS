<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add presentation</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script>
        // Check if the user is logged in and has the admin role
        fetch('check_session.php')
            .then(response => response.json())
            .then(data => {
                if (!data.isLoggedIn) {
                    // Redirect to the main page
                    window.location.href = 'index.html';
                }
            })
            .catch(error => {
                console.error('Error checking session:', error);
                // Redirect to the main page in case of an error
                window.location.href = 'index.html';
            });
    </script>
</head>
<body>

    <div class="header-container">
        <h2 style="float: left;">
            <a href="index.html" style="text-decoration: none; color: inherit;">
                <i class="fas fa-home" style="margin-right: 5px;"></i>
            </a>
            Add presentation
        </h2>
        <div style="float: right;">
            <!-- Tlačítko Login/Logout -->
            <a href="login.html" id="loginLogoutButton" class="login-button">Login</a>
            <a href="user_schedule.html" id="myScheduleButton" class="login-button" style="margin-right: 10px; display: none;">My Schedule</a>
            <!-- Dynamické tlačítko Admin Page -->
            <a href="admin_page.html" id="adminPageButton" class="login-button" style="display: none; margin-right: 10px;">Admin Page</a>
        </div>
    </div>

    <form id="presentationForm" class="form-container" method="POST" action="create_presentation.php">
        <h2 style="color: black;">Add presentation</h2>
        <input type="hidden" name="conference_id" value="<?php echo isset($_GET['conference_id']) ? $_GET['conference_id'] : ''; ?>">
        <input type="text" name="title" placeholder="Name" required>
        <textarea name="description" style="height: 100px;" placeholder="Description" required></textarea>
        <button type="submit" class="add-conference-button">Send</button>
    </form>

    <script>
        fetch('check_session.php')
        .then(response => response.json())
        .then(data => {
            const loginLogoutButton = document.getElementById('loginLogoutButton');
            const adminPageButton = document.getElementById('adminPageButton');
            const conferenceButton = document.getElementById('create_conference');
        
            if (data.isLoggedIn) {
                loginLogoutButton.textContent = 'Logout';
                loginLogoutButton.href = 'logout.php';
                conferenceButton.style.display = 'flex'
            
                if (data.role === 'admin') {
                    adminPageButton.style.display = 'inline-block';
                }
            
            } else {
                loginLogoutButton.textContent = 'Login';
                loginLogoutButton.href = 'login.html';
            }
        })
        .catch(error => console.error('Chyba při kontrole přihlášení:', error));

        // Check logged-in user role and display relevant buttons
        fetch('check_session.php')
            .then(response => response.json())
            .then(data => {
                const myScheduleButton = document.getElementById('myScheduleButton');
                const adminPageButton = document.getElementById('adminPageButton');

                if (data.isLoggedIn) {
                    myScheduleButton.style.display = 'inline-block'; // Zobrazit tlačítko My Schedule
                    if (data.role === 'admin') {
                        adminPageButton.style.display = 'inline-block'; // Zobrazit tlačítko Admin Page
                    }
                }
        })
        .catch(error => console.error('Error checking session:', error));
        
        document.getElementById("presentationForm").addEventListener("submit", function(e) {
            e.preventDefault();  // Zabraňuje defaultnímu odeslání formuláře
        
            const formData = new FormData(this);
            
            // Přidáme `conference_id` z URL do FormData
            const conferenceId = new URLSearchParams(window.location.search).get('conference_id');
            formData.append('conference_id', conferenceId);  // Přidáme ID do formuláře
            
            // Odeslání dat na backend
            fetch('create_presentation.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.text())  // Nebo response.json(), pokud vrací JSON
            .then(data => {
                console.log(data);
                alert('Presentation was sent!');
                const previousPage = sessionStorage.getItem('previousPage');
                if (previousPage) {
                    window.location.href = previousPage; // Přejít zpět na původní stránku
                } else {
                    window.location.href = 'conference_details.html'; // Pokud není uložena stránka, přejdeme na defaultní
                }
            })
            .catch(error => console.error('Error with sending data:', error));
        });
    </script>
</body> 
</html>