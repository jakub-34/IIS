<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seznam Konferencí</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

    <div class="header-container">
        <h2 style="float: left;">
            <a href="index.html" style="text-decoration: none; color: inherit;">
                <i class="fas fa-home" style="margin-right: 5px;"></i>
                Konference
            </a>
        </h2>
        <!-- Dynamické tlačítko Login/Logout -->
        <a href="login.html" id="loginLogoutButton" class="login-button">Login</a>
    </div>
    
    <div class="body">
        <table>
            <tbody id="conferenceTable">
            </tbody>
        </table>
    </div>
    
    <a href="add.html" class="fixed-button">
        <i class="fas fa-plus"></i>
    </a>

<script>
// Funkce pro kontrolu stavu přihlášení
function checkLoginStatus() {
    fetch('check_session.php')
        .then(response => response.json())
        .then(data => {
            const loginLogoutButton = document.getElementById('loginLogoutButton');
            if (data.isLoggedIn) {
                loginLogoutButton.textContent = 'Logout';
                loginLogoutButton.href = 'logout.php';
            } else {
                loginLogoutButton.textContent = 'Login';
                loginLogoutButton.href = 'login.html';
            }
        })
        .catch(error => console.error('Chyba při kontrole přihlášení:', error));
}

// Načtení stavu přihlášení po otevření stránky
checkLoginStatus();

// Načtení konferencí z PHP skriptu
fetch('get_conferences.php')
    .then(response => response.json())
    .then(data => {
        var count = 1;
        const tableBody = document.getElementById('conferenceTable');

        // Hlavní obalovací div pro dva sloupce
        const mainContainer = document.createElement('div');
        mainContainer.style.display = 'flex';        
        mainContainer.style.justifyContent = 'space-between';
        mainContainer.style.gap = '20px';            

        // Levý a pravý sloupec
        const leftColumn = document.createElement('div');
        leftColumn.style.flex = '1';

        const rightColumn = document.createElement('div');
        rightColumn.style.flex = '1';

        // Iterace přes data konferencí
        data.forEach(conference => {
            const containerDiv = document.createElement('div');
            containerDiv.style.display = 'flex';
            containerDiv.style.alignItems = 'center';
            containerDiv.style.marginBottom = '10px';

            const text = document.createElement('p');
            text.innerHTML = `${count}`;
            text.style.marginRight = '10px';
            text.style.fontWeight = 'bold';

            const wrapperDiv = document.createElement('div');
            wrapperDiv.className = "conference";

            const row1 = document.createElement('tr');
            row1.innerHTML = `<td colspan="2">${conference.name}</td>`;
            row1.style.paddingBottom = '10vw';
            wrapperDiv.appendChild(row1);

            const row2 = document.createElement('tr');
            row2.innerHTML = `<td>${new Date(conference.start_datetime).getDate()}.${new Date(conference.start_datetime).getMonth() + 1}. - ${new Date(conference.end_datetime).toLocaleDateString()}</td><td>${new Date(conference.start_datetime).toLocaleTimeString('cs-CZ',  { hour: '2-digit', minute: '2-digit', hour12: false })}</td>-<td>${new Date(conference.end_datetime).toLocaleTimeString('cs-CZ',  { hour: '2-digit', minute: '2-digit', hour12: false })}</td>`;
            wrapperDiv.appendChild(row2);

            containerDiv.appendChild(text);
            containerDiv.appendChild(wrapperDiv);

            if (count % 2 !== 0) {
                leftColumn.appendChild(containerDiv);
            } else {
                rightColumn.appendChild(containerDiv);
            }

            count++;
        });

        mainContainer.appendChild(leftColumn);
        mainContainer.appendChild(rightColumn);
        tableBody.appendChild(mainContainer);

    })
    .catch(error => console.error('Chyba při načítání dat:', error));
</script>

</body>
</html>
