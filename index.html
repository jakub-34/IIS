<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seznam Konferencí</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

    <div class="header-container">
        <h2 style="float: left;">
            <a href="index.html" style="text-decoration: none; color: inherit;">
                <i class="fas fa-home" style="margin-right: 5px;"></i>
                Konference
            </a>
        </h2>
        <div style="float: right;">
            <!-- Tlačítko Login/Logout -->
            <a href="login.html" id="loginLogoutButton" class="login-button">Login</a>
            <a href="user_schedule.html" id="myScheduleButton" class="login-button" style="margin-right: 10px; display: none;">My Schedule</a>
            <!-- Dynamické tlačítko Admin Page -->
            <a href="admin_page.html" id="adminPageButton" class="login-button" style="display: none; margin-right: 10px;">Admin Page</a>
        </div>
    </div>
    
    <div class="body">
        <table>
            <tbody id="conferenceTable">
            </tbody>
        </table>
    </div>
    
    <a href="create_conference.html" class="fixed-button" id="create_conference" style="display: none;">
        <i class="fas fa-plus"></i>
    </a>

<script>
// Funkce pro kontrolu stavu přihlášení
function checkLoginStatus() {
    fetch('check_session.php')
        .then(response => response.json())
        .then(data => {
            const loginLogoutButton = document.getElementById('loginLogoutButton');
            const adminPageButton = document.getElementById('adminPageButton');
            const conferenceButton = document.getElementById('create_conference');

            if (data.isLoggedIn) {
                loginLogoutButton.textContent = 'Logout';
                loginLogoutButton.href = 'logout.php';
                conferenceButton.style.display = 'flex'

                if (data.role === 'admin') {
                    adminPageButton.style.display = 'inline-block';
                }

            } else {
                loginLogoutButton.textContent = 'Login';
                loginLogoutButton.href = 'login.html';
            }
        })
        .catch(error => console.error('Chyba při kontrole přihlášení:', error));
}

// Načtení stavu přihlášení po otevření stránky
checkLoginStatus();

// Načtení konferencí z PHP skriptu
fetch('get_conferences.php')
    .then(response => response.json())
    .then(data => {
        var count = 1;
        const tableBody = document.getElementById('conferenceTable');

        // Hlavní obalovací div pro dva sloupce
        const mainContainer = document.createElement('div');
        mainContainer.style.display = 'flex';        
        mainContainer.style.justifyContent = 'space-between';
        mainContainer.style.gap = '20px';            

        // Levý a pravý sloupec
        const leftColumn = document.createElement('div');
        leftColumn.style.flex = '1';

        const rightColumn = document.createElement('div');
        rightColumn.style.flex = '1';

        // Iterace přes data konferencí
        data.forEach(conference => {
            const containerDiv = document.createElement('div');
            containerDiv.style.display = 'flex';
            containerDiv.style.alignItems = 'center';
            containerDiv.style.marginBottom = '10px';
            containerDiv.style.cursor = 'pointer';

            containerDiv.onclick = () => {
                window.location.href = `conference_details.php?id=${conference.conference_id}`;
            };

            const text = document.createElement('p');
            text.innerHTML = `${count}`;
            text.style.marginRight = '10px';
            text.style.fontWeight = 'bold';

            const wrapperDiv = document.createElement('div');
            wrapperDiv.className = "conference";

            const row1 = document.createElement('tr');
            row1.innerHTML = `<td colspan="2">${conference.name}</td>`;
            row1.style.paddingBottom = '10vw';
            wrapperDiv.appendChild(row1);

            const row2 = document.createElement('tr');
            row2.innerHTML = `<td>${new Date(conference.start_datetime).toLocaleDateString()} - ${new Date(conference.end_datetime).toLocaleDateString()}</td><td>${new Date(conference.start_datetime).toLocaleTimeString('cs-CZ',  { hour: '2-digit', minute: '2-digit', hour12: false })}</td>-<td>${new Date(conference.end_datetime).toLocaleTimeString('cs-CZ',  { hour: '2-digit', minute: '2-digit', hour12: false })}</td>`;
            wrapperDiv.appendChild(row2);

            containerDiv.appendChild(text);
            containerDiv.appendChild(wrapperDiv);

            if (count % 2 !== 0) {
                leftColumn.appendChild(containerDiv);
            } else {
                rightColumn.appendChild(containerDiv);
            }

            count++;
        });

        mainContainer.appendChild(leftColumn);
        mainContainer.appendChild(rightColumn);
        tableBody.appendChild(mainContainer);

    })
    .catch(error => console.error('Chyba při načítání dat:', error));

    // Check logged-in user role and display relevant buttons
    fetch('check_session.php')
        .then(response => response.json())
        .then(data => {
            const myScheduleButton = document.getElementById('myScheduleButton');
            const adminPageButton = document.getElementById('adminPageButton');

            if (data.isLoggedIn) {
                myScheduleButton.style.display = 'inline-block'; // Zobrazit tlačítko My Schedule
                if (data.role === 'admin') {
                    adminPageButton.style.display = 'inline-block'; // Zobrazit tlačítko Admin Page
                }
            }
    })
    .catch(error => console.error('Error checking session:', error));

</script>

</body>
</html>
